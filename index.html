<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link 
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" 
        rel="stylesheet" 
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" 
        crossorigin="anonymous">

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">

    <title>Pomodoro Timer</title>

    <script>
        let running;

        function reset() {
            // 1. Stop timer
            stopTimer();
            // 2. Reset break length to 5min
            document.getElementById("break-length").value = "5";
            // 3. Reset session length to 25min
            document.getElementById("session-length").value = "25";
            // 4. Reset time-left
            document.getElementById("time-left").innerText = "25:00";
            // Reset timer label
            document.getElementById("timer-label").innerText = "GO";
        }
        function updateBreak() {
            let min = parseInt(document.getElementById("break-length").value);
            if(min > 10) {
                document.getElementById("time-left").innerText = min.toString() + ":00";
            }
            else {
                document.getElementById("time-left").innerText = "0" + min.toString() + ":00";
            }
        }
        function updateSession() {
            let min = parseInt(document.getElementById("session-length").value);
            if(min > 10) {
                document.getElementById("time-left").innerText = min.toString() + ":00";
            }
            else {
                document.getElementById("time-left").innerText = "0" + min.toString() + ":00";
            }
            // document.getElementById("time-left").innerText = document.getElementById("session-length").value;
            // document.getElementById("time-left").innerText += ":00"; 
        }
        function decrementBreak() {
            let num = parseInt(document.getElementById("break-length").value);
            if(num > 1) {
                document.getElementById("break-length").value = num - 1;
            }
        }
        function incrementBreak() {
            let num = parseInt(document.getElementById("break-length").value);
            if(num < 60) {
                document.getElementById("break-length").value = num + 1;
            }
        }
        function decrementSession() {
            let num = parseInt(document.getElementById("session-length").value);
            if(num > 1) {
                document.getElementById("session-length").value = num - 1;
                updateSession();
            }
        }
        function incrementSession() {
            let num = parseInt(document.getElementById("session-length").value);
            if(num < 60) {
                document.getElementById("session-length").value = num + 1;
                updateSession();
            }
        }

        function timer(restart) {
            if(!running) {
                running = setInterval(countDown, 1000);

                document.getElementById("start_stop").innerHTML = "<i class='bi bi-pause'></i>";
            }
            else {
                stopTimer();
            }

            if(restart == "restart") {
                running = setInterval(countDown, 1000);
            }
        }

        function stopTimer() {
            clearInterval(running);
            running = null;

            //Change start_stop button to play icon
            document.getElementById("start_stop").innerHTML = "<i class='bi bi-play'></i>";
        }

        function countDown() {
            let time = document.getElementById("time-left").innerText;

            if(time == "00:00") {
                changeMode();
                time = document.getElementById("time-left").innerText;
                timer("restart");
            }
            else {
                let min;
                let sec;

                if(time.length > 4) {
                    min = parseInt(time.slice(0,2));
                    sec = parseInt(time.slice(3));
                }
                else {
                    min = parseInt(time.slice(0,1));
                    sec = parseInt(time.slice(2));
                }

                // console.log(sec);

                let newMin;
                let newSec;

                if(sec > 0) {
                    newMin = min;
                    newSec = sec - 1;
                }
                else if(sec == 0) {
                    newMin = min - 1;
                    newSec = 59;
                }

                let newTime;
                
                if(newMin >= 10 && newSec >= 10) {
                    newTime = newMin.toString() + ":" + newSec.toString();
                    
                }
                else if((newMin < 10 && newSec >= 10)){
                    newTime = "0" + newMin.toString() + ":" + newSec.toString();
                }
                else if(newMin >= 10 && newSec < 10) {
                    newTime = newMin.toString() + ":0" + newSec.toString();
                }
                else {
                    newTime = "0" + newMin.toString() + ":0" + newSec.toString();
                }
                document.getElementById("time-left").innerText = newTime;
            }
        }
        function changeMode() {
            let state = document.getElementById("timer-label").innerText;

            if(state == "GO") {
                // console.log("Change to rest");

                document.getElementById("timer-label").innerText = "REST";
                updateBreak();
            }
            if(state == "REST") {
                // console.log("Change to go");

                document.getElementById("timer-label").innerText = "GO";
                updateSession();
            }
        }
    </script>
  </head>

  <body>
    <div class='container-fluid'>
        <div class='row'>
            <div class='col text-center'>
                <h1>Pomodoro Timer</h1>
            </div>
        </div>
        <div class='row'>
            <div class='col text-center'>

                <div class="card">
                    <div class="card-body">
                        <h1 class="card-title">Pomodoro Timer</h1>
                        <p class="card-text">

                            <div id="time-left">25:00</div>
                            <!-- <time id="time-left">25:00</time> -->

                            <div id="timer-label">GO</div>
                            <button id="start_stop" type="button" class="btn btn-outline-primary" onclick="timer()">
                                <i class="bi bi-play"></i>
                            </button>
                            <button id="reset" type="button" class="btn btn-outline-primary" onclick="reset()">
                                <i class="bi bi-arrow-clockwise"></i>
                            </button>
                        </p>
                    </div>
                </div>

                <div id='break'>
                    <div id='break-label'>Rest</div>

                    <input id="break-length" type="number" class="form-control" value="5" min="1" max="60">

                    <div class='btn-group-vertical'>
                        <button id="break-increment" type="button" class="btn btn-outline-primary" onclick="incrementBreak()">
                            <i class="bi bi-chevron-up"></i>
                        </button>
                        <button id="break-decrement" type="button" class="btn btn-outline-primary" onclick="decrementBreak()">
                            <i class="bi bi-chevron-down"></i>
                        </button>
                    </div>
                </div>
                <div id='session'>
                    <div id='session-label'>Work</div>

                    <input id="session-length" type="number" class="form-control" value="25" onchange="updateSession()" onkeyup="updateSession()" min="1" max="60">

                    <div class='btn-group-vertical'>
                        <button id="session-increment" type="button" class="btn btn-outline-primary" onclick="incrementSession()">
                            <i class="bi bi-chevron-up"></i>
                        </button>
                        <button id="session-decrement" type="button" class="btn btn-outline-primary" onclick="decrementSession()">
                            <i class="bi bi-chevron-down"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script 
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" 
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" 
        crossorigin="anonymous"></script>
    <!-- FreeCodeCamp Test CDN -->
    <script src="https://cdn.freecodecamp.org/testable-projects-fcc/v1/bundle.js"></script>
  </body>
</html>